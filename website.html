<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Leaderboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>
<body class="bg-gray-100 font-sans">
    <div x-data="leaderboard()" class="container mx-auto px-4 py-8">
        <h1 class="text-4xl font-bold text-center text-indigo-600 mb-8">Game Leaderboard</h1>

        <div class="bg-white shadow-md rounded-lg overflow-hidden">
            <table class="w-full">
                <thead class="bg-indigo-500 text-white">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Rank</th>
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Name</th>
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Score</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    <template x-for="(player, index) in leaderboardData" :key="index">
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" x-text="index + 1"></td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="player.name"></td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="player.score"></td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>
        <div class="mt-4 text-center text-sm text-gray-500">
            Last updated: <span x-text="lastUpdated"></span>
        </div>
    </div>

    <script>
        function leaderboard() {
            return {
                leaderboardData: [],
                lastUpdated: '',
                refreshInterval: null,
                init() {
                    this.fetchLeaderboard();
                    // 设置每30秒自动刷新一次
                    this.refreshInterval = setInterval(() => {
                        this.fetchLeaderboard();
                    }, 30000);
                },
                async fetchLeaderboard() {
                    try {
                        const response = await fetch('http://localhost:8000/leaderboard?limit=10');
                        const data = await response.json();
                        this.leaderboardData = data.leaderboard;
                        this.lastUpdated = new Date().toLocaleTimeString();
                    } catch (error) {
                        console.error('Error fetching leaderboard:', error);
                    }
                },
                // 在组件销毁时清除 interval
                destroy() {
                    if (this.refreshInterval) {
                        clearInterval(this.refreshInterval);
                    }
                }
            }
        }
    </script>
</body>
</html>